# Frontend

Static React app for browsing and comparing Gothenburg preschool quality surveys. Reads pre-generated JSON files — no API or database required at runtime.

## Tech stack

- **React 18** + **TypeScript 5.7** (strict mode)
- **Vite 6** (build + dev server)
- **ECharts 5** (charts: trends, distributions, comparisons)
- **Leaflet 1.9** (interactive map)
- **react-router-dom 6** with `HashRouter` (GitHub Pages compatible)
- Dark theme (GitHub-inspired)

## Development

```bash
npm install
npm run dev        # Dev server at http://localhost:5173
npm run build      # Type-check + production build → dist/
npm run preview    # Preview production build locally
```

## Pages

### Map (`/`)
Interactive Leaflet map of Gothenburg with color-coded school markers (green/orange/red by normalized score). Address search via Nominatim. Year selector. Click a marker to view school details.

### Browse (`/browse`)
Year-based browsing with collapsible area cards. Each area shows its schools with mean scores. Expandable units for schools with sub-units. Global search across all schools.

### Detail (`/school/:id`)
Full school report view:
- Metadata (name, area, year, response rate, respondent count)
- Question area score cards (school vs. city average)
- Trend chart (multi-year historical development)
- Response distribution (stacked Likert bars)
- Gender split (Flicka/Pojke/Total toggle)
- Demographics (birth year, child/parent gender)
- Most important questions (parent rankings)
- Unit means breakdown (per class/unit)
- Full means table with GR/Goteborg/district comparisons
- Related reports navigation (parent school, sibling units)
- Link to original PDF

### Compare (`/compare?ids=...`)
Multi-school comparison (selected via `/compare/build`):
- Side-by-side demographics
- Score comparison by question area
- Multi-line trend chart
- Deviation from average
- Response distribution overlay
- Gender gap comparison

## Data loading

All data comes from static JSON files in `public/data/`, generated by the pipeline's export step. No runtime API calls.

```
public/data/
├── index.json                  # Master index (years, areas, schools with scores + coordinates)
├── schools/{year}-{area}.json  # Per-area school summaries
└── detail/{reportId}.json      # Full per-school detail
```

The data client (`src/data/client.ts`) provides three async functions:
- `loadIndex()` — fetches and caches `index.json`
- `loadAreaSchools(year, areaSlug)` — fetches area summary
- `loadSchoolDetail(id)` — fetches full school detail

Base path is resolved from `import.meta.env.BASE_URL` (configured as `/forskoleenkaten-gbg/` for GitHub Pages).

## Deployment

Deployed to GitHub Pages via GitHub Actions (`.github/workflows/deploy.yml`):

1. Push to `main` triggers the workflow
2. Node 20 + `npm ci` + `npm run build` (includes `tsc -b` type-check)
3. Uploads `frontend/dist/` as a Pages artifact
4. Deploys via `actions/deploy-pages@v4`

The `HashRouter` ensures client-side routing works on GitHub Pages (which only serves `index.html` for the root path). All routes use `/#/path` format.

## Source files

```
frontend/src/
├── pages/
│   ├── MapHome.tsx           # Map view with address search
│   ├── Home.tsx              # Browse by year/area
│   ├── SchoolDetail.tsx      # Per-school detail view
│   ├── ComparePicker.tsx     # Select schools for comparison
│   └── Compare.tsx           # Multi-school comparison
├── components/
│   ├── TrendChart.tsx        # Multi-year line chart
│   ├── ResponseDistribution.tsx  # Stacked Likert bar chart
│   ├── GenderSplitChart.tsx  # Gender comparison bars
│   ├── DemographicsPanel.tsx # Birth year + gender distributions
│   ├── SchoolSearch.tsx      # Autocomplete search
│   ├── SchoolCompare.tsx     # Question area comparison table
│   ├── CompareTrendChart.tsx # Multi-school trend overlay
│   ├── CompareDeviation.tsx  # Deviation from average
│   ├── CompareResponseDist.tsx   # Response distribution comparison
│   ├── CompareDemographics.tsx   # Demographics side-by-side
│   └── CompareGenderGap.tsx  # Gender gap comparison
├── data/
│   └── client.ts             # Data loading + TypeScript interfaces
├── hooks/
│   └── useAddressSearch.ts   # Nominatim geocoding hook (debounced)
├── utils/
│   ├── colors.ts             # Color palette for multi-school comparison
│   └── geo.ts                # Haversine distance calculation
├── App.tsx                   # Root router + navigation header
├── main.tsx                  # React entry point
└── index.css                 # Global dark theme styles
```
